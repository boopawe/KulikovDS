# setup.py
!pip install --upgrade pip transformers datasets peft trl accelerate bitsandbytes


# prepare_data.py
with open('test_questions.txt', 'w', encoding='utf-8') as f:
    f.write("""Видеомонтаж — это
Основная задача видеомонтажа заключается в том, что
Хороший видеомонтаж отличается от любительского тем, что
Для видеомонтажа чаще всего используют программы
""")

print("test_questions.txt создан")


# dataset.py
import json

data = [
    {"prompt": "Что такое видеомонтаж?", "response": "Видеомонтаж — это процесс создания единого видео из отдельных клипов путём их нарезки, склейки, добавления эффектов и звука."},
    {"prompt": "В чём основная задача видеомонтажа?", "response": "Основная задача видеомонтажа — создать логически связанный и эмоционально воздействующий рассказ из сырых видеоматериалов."},
    {"prompt": "Чем хороший видеомонтаж отличается от любительского?", "response": "Хороший видеомонтаж отличается от любительского тем, что соблюдает ритм, использует плавные переходы, точно синхронизирует звук и имеет чистый монтажный ритм."},
    {"prompt": "С чего обычно начинается процесс монтажа?", "response": "Процесс монтажа обычно начинается с импорта видеофайлов в монтажную программу и создания черновой последовательности клипов."},
    {"prompt": "Что необходимо для качественного видеомонтажа?", "response": "Для качественного видеомонтажа в первую очередь необходимо мощный компьютер с хорошей видеокартой и большим объёмом оперативной памяти."},
    {"prompt": "Для чего используется Adobe Premiere Pro?", "response": "Adobe Premiere Pro используется для профессионального нелинейного видеомонтажа с поддержкой 4K, цветокоррекции и многодорожечного аудио."},
    {"prompt": "Чем отличается DaVinci Resolve?", "response": "DaVinci Resolve отличается тем, что бесплатный, имеет лучший инструмент цветокоррекции и поддерживает профессиональный grading."},
    {"prompt": "Среди кого популярен Final Cut Pro?", "response": "Final Cut Pro популярен среди пользователей macOS благодаря оптимизации под Apple Silicon и магнитной таймлайне."},
    {"prompt": "Что такое хронология в монтажных программах?", "response": "Хронология в монтажных программах — это горизонтальная шкала времени, где располагаются видеодорожки, аудио и эффекты."},
    {"prompt": "Для чего служат переходы в видеомонтаже?", "response": "Переходы в видеомонтаже служат для плавного соединения клипов: fade, dissolve, wipe, zoom и другие эффекты."},
    {"prompt": "Зачем применяется цветокоррекция?", "response": "Цветокоррекция применяется чтобы выровнять экспозицию, контраст, цветовой баланс и создать желаемую атмосферу."},
    {"prompt": "Что включает монтаж звука?", "response": "Монтаж звука включает сведение аудиодорожек, эквализацию, компрессию и добавление Foley-эффектов."},
    {"prompt": "Для чего используется keyframe-анимация?", "response": "Keyframe-анимация используется для плавного изменения параметров эффектов во времени: масштаба, позиции, прозрачности."},
    {"prompt": "Когда применяют proxy-файлы?", "response": "Proxy-файлы применяют когда видеоматериалы в высоком разрешении тормозят воспроизведение на слабом железе."},
    {"prompt": "Что нужно настраивать при экспорте видео?", "response": "Экспорт видео требует настройки кодека (H.264, ProRes), битрейта, разрешения и контейнера (MP4, MOV)."},
    {"prompt": "Зачем добавляют субтитры?", "response": "Субтитры добавляют для улучшения доступности, перевода и усиления ключевых моментов диалогов."},
    {"prompt": "Где создаётся моушн-графика?", "response": "Моушн-графика создаётся в After Effects или встроенных инструментах Premiere/DaVinci для анимированных текстов и логотипов."},
    {"prompt": "Что такое render queue?", "response": "Render queue — это очередь список задач на экспорт видео в монтажных программах для пакетной обработки."},
    {"prompt": "Что такое L-cut и J-cut?", "response": "L-cut и J-cut — это монтажные приёмы где звук одного клипа начинается до или продолжается после смены видео."},
    {"prompt": "Что рекомендуют для обучения видеомонтажу?", "response": "Для обучения видеомонтажу рекомендуют бесплатные версии DaVinci Resolve, Premiere Rush и курсы на YouTube/Skillbox."},
    {"prompt": "Что такое кадр в видеомонтаже?", "response": "Кадр в видеомонтаже — это единичное статичное изображение, из которого состоит видео при определённом FPS."},
    {"prompt": "Что означает FPS?", "response": "FPS означает Frames Per Second — количество кадров в секунду, определяющее плавность видео."},
    {"prompt": "Для чего используется хромакей?", "response": "Хромакей используется для замены фона (обычно зелёного или синего) на другое изображение или видео."},
    {"prompt": "Что такое кодек?", "response": "Кодек — это алгоритм сжатия видео: H.264, H.265/HEVC, ProRes, DNxHD и другие."},
    {"prompt": "Что такое джампкат (Jump Cut)?", "response": "Джампкат (Jump Cut) — это резкий переход между похожими кадрами, создающий эффект прыжка во времени."},
    {"prompt": "Что такое кроссфейд (Crossfade)?", "response": "Кроссфейд (Crossfade) — это плавное затемнение одного клипа и появление следующего."},
    {"prompt": "Для чего применяется Speed Ramp?", "response": "Speed Ramp применяется для изменения скорости видео: замедления, ускорения или плавных переходов темпа."},
    {"prompt": "Для чего используется маскирование (Masking)?", "response": "Маскирование (Masking) используется для выделения части изображения, скрытия или наложения элементов."},
    {"prompt": "Что такое LUT?", "response": "LUT — это Look-Up Table — готовый цветовой пресет для быстрой цветокоррекции."},
    {"prompt": "Чем грейдинг отличается от цветокоррекции?", "response": "Грейдинг отличается от цветокоррекции тем, что создаёт художественное настроение сцены, а не просто выравнивает цвета."},
    {"prompt": "За что отвечает экспозиция?", "response": "Экспозиция отвечает за уровень освещённости кадра — яркость светлых и тёмных участков."},
    {"prompt": "Что регулирует насыщенность (Saturation)?", "response": "Насыщенность (Saturation) регулирует интенсивность цветов в видео от ч/б до ярких оттенков."},
    {"prompt": "Что определяет контраст?", "response": "Контраст определяет разницу между светлыми и тёмными участками изображения."},
    {"prompt": "Что включает саунд-дизайн?", "response": "Саунд-дизайн включает создание звукового оформления: музыка, эффекты, атмосфера."},
    {"prompt": "Что такое Foley-эффекты?", "response": "Foley-эффекты — это искусственно записанные повседневные звуки: шаги, хлопки, скрип."},
    {"prompt": "Что такое Ducking?", "response": "Ducking — это автоматическое приглушение музыки при появлении речи или других важных звуков."},
    {"prompt": "Для чего используется EQ (эквалайзер)?", "response": "EQ (эквалайзер) используется для настройки частот звука: низкие, средние, высокие частоты."},
    {"prompt": "Что создаёт реверберация (Reverb)?", "response": "Реверберация (Reverb) создаёт эффект эха и объёмного звучания, имитируя разные акустические пространства."},
    {"prompt": "Что такое таймлайн?", "response": "Таймлайн — это основная рабочая область монтажной программы с дорожками и клипами."},
    {"prompt": "Что такое бин (Bin) в монтажных программах?", "response": "Бин (Bin) в монтажных программах — это папка для организации видеофайлов, аудио и графики."},
    {"prompt": "Что такое черновой монтаж (Rough Cut)?", "response": "Черновой монтаж (Rough Cut) — это первая сборка видео с основной последовательностью сцен."},
    {"prompt": "Что включает финальный монтаж (Fine Cut)?", "response": "Финальный монтаж (Fine Cut) включает точную обрезку, переходы, эффекты и цветокоррекцию."},
    {"prompt": "Где есть магнитная таймлайн?", "response": "Магнитная таймлайн есть в Final Cut Pro — автоматически прилипающие клипы упрощают монтаж."},
    {"prompt": "Что позволяет нелинейный монтаж?", "response": "Нелинейный монтаж позволяет менять порядок клипов в любом месте без потери качества."},
    {"prompt": "От чего зависит монтажный ритм?", "response": "Монтажный ритм зависит от длительности кадров, музыки и эмоционального воздействия."},
    {"prompt": "Что такое Match Cut?", "response": "Match Cut — это переход по форме, движению или содержанию между разными сценами."},
    {"prompt": "Что такое разрез по движению (Cut on Action)?", "response": "Разрез по движению (Cut on Action) — это смена кадра во время активного движения для плавности."},
    {"prompt": "Что подразумевает монтаж по звуку?", "response": "Монтаж по звуку подразумевает синхронизацию видео с аудиодорожкой или музыкой."},
    {"prompt": "Что определяет битрейт?", "response": "Битрейт определяет количество данных в секунду видео — влияет на качество и размер."},
    {"prompt": "Чем VBR отличается от CBR?", "response": "VBR отличается от CBR тем, что меняет битрейт динамически в зависимости от сложности кадра."},
    {"prompt": "Где используется оптимизированный RAM Preview?", "response": "Оптимизированный RAM Preview используется в After Effects для предварительного просмотра эффектов."},
    {"prompt": "Что такое композиция в After Effects?", "response": "Композиция в After Effects — это рабочая область с слоями для моушн-графики и эффектов."},
    {"prompt": "Для чего применяется Null Object?", "response": "Null Object применяется для управления анимацией нескольких слоёв через родительские связи."},
    {"prompt": "Что такое Track Matte в After Effects?", "response": "Track Matte в After Effects — это использование одного слоя для маскировки содержимого другого."},
    {"prompt": "Для чего используется Adjustment Layer?", "response": "Adjustment Layer используется для нанесения эффектов на несколько клипов одновременно."},
    {"prompt": "Что позволяет Dynamic Link между Premiere и After Effects?", "response": "Dynamic Link между Premiere и After Effects позволяет редактировать эффекты в AE без повторного рендера."},
    {"prompt": "Для чего используется XML-экспорт?", "response": "XML-экспорт используется для переноса проектов между Premiere Pro и DaVinci Resolve."},
    {"prompt": "Что такое Power Bins в DaVinci Resolve?", "response": "Power Bins в DaVinci Resolve — это готовые эффекты, переходы и пресеты от Blackmagic Design."},
    {"prompt": "Для чего предназначена Fusion Page в DaVinci Resolve?", "response": "Fusion Page в DaVinci Resolve предназначена для сложных композитингов и 3D-эффектов."},
    {"prompt": "Что такое Fairlight в DaVinci Resolve?", "response": "Fairlight в DaVinci Resolve — это профессиональная звуковая рабочая станция."},
    {"prompt": "Для чего лучше всего подходит Color Page в DaVinci Resolve?", "response": "Color Page в DaVinci Resolve лучше всего подходит для глубокой цветокоррекции с узлами и квалификатором."},
    {"prompt": "Для чего используется Cut Page?", "response": "Cut Page используется для быстрого чернового монтажа и двойного экрана."},
    {"prompt": "Что позволяет Magic Mask в DaVinci Resolve?", "response": "Magic Mask в DaVinci Resolve позволяет автоматически отслеживать объекты для маскировки."},
    {"prompt": "Для чего применяется Relight в DaVinci Resolve?", "response": "Relight в DaVinci Resolve применяется для изменения освещения на отснятом видео."},
    {"prompt": "Что изолирует Voice Isolation?", "response": "Voice Isolation изолирует голос от фонового шума в DaVinci Resolve."},
    {"prompt": "Что делает Scene Cut Detection?", "response": "Scene Cut Detection автоматически находит монтажные точки в длинных клипах."},
    {"prompt": "Что делает Auto Color в DaVinci Resolve?", "response": "Auto Color в DaVinci Resolve автоматически выравнивает цвета между клипами."},
    {"prompt": "Когда нужна стабилизация видео?", "response": "Стабилизация видео нужна когда камера трясётся или снимает с рук без стабилизатора."},
    {"prompt": "Где работает Warp Stabilizer?", "response": "Warp Stabilizer работает в Premiere Pro — анализирует движение и сглаживает дрожание."},
    {"prompt": "Для чего используется Roto Brush?", "response": "Roto Brush используется для выделения движущихся объектов по пикселям в After Effects."},
    {"prompt": "Что делает Content-Aware Fill?", "response": "Content-Aware Fill автоматически заполняет удалённые области похожим контентом."},
    {"prompt": "Что сглаживает Morph Cut?", "response": "Morph Cut сглаживает резкие переходы между дублями одного человека."},
    {"prompt": "Что содержит Essential Graphics Panel?", "response": "Essential Graphics Panel содержит шаблоны моушн-графики для Premiere Pro."},
    {"prompt": "Что делает Speech to Text в Premiere Pro?", "response": "Speech to Text в Premiere Pro автоматически создаёт субтитры из речи."},
    {"prompt": "Для чего используется Auto Reframe?", "response": "Auto Reframe адаптирует видео под вертикальный формат для соцсетей."},
    {"prompt": "Что такое Lumetri Color?", "response": "Lumetri Color — это панель цветокоррекции в Premiere Pro с пресетами и кривыми."},
    {"prompt": "Что регулирует Audio Track Mixer?", "response": "Audio Track Mixer регулирует громкость и панорамирование всех аудиодорожек."},
    {"prompt": "Что позволяет Multicam Editing?", "response": "Multicam Editing позволяет монтировать из нескольких камер одновременно."},
    {"prompt": "Что такое Nested Sequences?", "response": "Nested Sequences — это вложенные последовательности для организации сложных проектов."},
    {"prompt": "Для чего ставят markers на таймлайне?", "response": "Markers на таймлайне ставят для отметки важных моментов, синхронизации или заметок."},
    {"prompt": "Для чего используются Bezier Curves?", "response": "Bezier Curves используются для плавной анимации скорости и эффектов."},
    {"prompt": "Что делает Ease In/Out?", "response": "Ease In/Out делает анимацию плавной в начале и конце движения."},
    {"prompt": "Что добавляет Overshoot?", "response": "Overshoot добавляет эффект перелёта и возврата в анимации."},
    {"prompt": "Что создаёт Wiggle Expression?", "response": "Wiggle Expression создаёт случайное дрожание параметров во времени."},
    {"prompt": "Что позволяет Time Remapping?", "response": "Time Remapping позволяет менять скорость видео с ключевыми кадрами."},
    {"prompt": "Что повторяет Echo Effect?", "response": "Echo Effect повторяет элемент с затуханием для слоу-мо или призраков."},
    {"prompt": "Что генерирует CC Particle World?", "response": "CC Particle World генерирует частицы для спецэффектов в After Effects."},
    {"prompt": "Что создаёт Optical Flares?", "response": "Optical Flares создаёт реалистичные линзовые блики и вспышки света."},
    {"prompt": "Для чего популярный плагин Trapcode Particular?", "response": "Trapcode Particular — популярный плагин для физически корректных 3D-частиц."},
    {"prompt": "Что позволяет Element 3D?", "response": "Element 3D позволяет импортировать и анимировать 3D-модели."},
    {"prompt": "Что требует 4K видео?", "response": "4K видео требует мощного железа и минимум 16 ГБ RAM для комфортной работы."},
    {"prompt": "Чем отличается HDR цветовое пространство?", "response": "HDR цветовое пространство отличается большим динамическим диапазоном и яркостью."},
    {"prompt": "Что такое Dolby Vision?", "response": "Dolby Vision — это динамический HDR-метаданные для ТВ и стриминга."},
    {"prompt": "Для чего используется Log формат?", "response": "Log формат используется для максимального сохранения информации о яркости."},
    {"prompt": "Что такое Rec.709?", "response": "Rec.709 — стандартный цветовой профиль для HD видео."},
    {"prompt": "Чем 10-битное видео лучше 8-битного?", "response": "10-битное видео лучше 8-битного тем, что меньше цветовых артефактов при градиентах."},
    {"prompt": "Чем Interlaced видео отличается от Progressive?", "response": "Interlaced видео отличается от Progressive тем, что показывает чётные и нечётные строки поочерёдно."},
    {"prompt": "Что такое монтаж по крупности?", "response": "Монтаж по крупности подразумевает последовательную смену планов от общего к среднему и крупному для логичного раскрытия действия."},
    {"prompt": "Что означает монтаж по смещению осей?", "response": "Монтаж по смещению осей требует размещения камер под разными углами, чтобы избежать эффекта 'прыжка' при смене кадров."},
    {"prompt": "Для чего нужен монтаж по направлению движения?", "response": "Монтаж по направлению движения сохраняет траекторию объекта в кадре для создания ощущения непрерывности."},
    {"prompt": "Что такое монтаж по фазе движения?", "response": "Монтаж по фазе движения склеивает кадры в одинаковой стадии жеста или движения объекта для плавности."},
    {"prompt": "Что подразумевает вертикальный монтаж?", "response": "Вертикальный монтаж сочетает изображение и звук из разных источников для усиления эмоционального воздействия."},
    {"prompt": "Что такое хронометраж в видеомонтаже?", "response": "Хронометраж определяет общую длительность видеоматериала или отдельной сцены."},
    {"prompt": "Что такое афтешот?", "response": "Афтешот — это дополнительная съёмка недостающих кадров после основного этапа производства."},
    {"prompt": "Для чего используется раскадровка?", "response": "Раскадровка представляет собой последовательность рисунков, иллюстрирующих будущий монтаж видео."},
    {"prompt": "Что такое шоурил?", "response": "Шоурил — демонстрационный ролик с лучшими фрагментами работ монтажёра или студии."},
    {"prompt": "Что означает внутрикадровый монтаж?", "response": "Внутрикадровый монтаж использует приёмы внутри одного кадра: панораму, фокусировку, зум."},
    {"prompt": "Что такое параллельный монтаж?", "response": "Параллельный монтаж показывает одновременные события в разных местах через чередование сцен."},
    {"prompt": "Для чего применяют ассоциативный монтаж?", "response": "Ассоциативный монтаж создаёт связи между кадрами через ассоциации и символизм."},
    {"prompt": "Что такое контрастный монтаж?", "response": "Контрастный монтаж противопоставляет кадры для усиления драматического эффекта."},
    {"prompt": "Что подразумевает ритмический монтаж?", "response": "Ритмический монтаж подстраивает длительность кадров под музыкальный ритм или темп."},
    {"prompt": "Для чего нужна закадровая музыка?", "response": "Закадровая музыка существует вне действия героев и служит для передачи эмоций зрителю."},
    {"prompt": "Что такое внутрикадровая музыка?", "response": "Внутрикадровая музыка звучит из источника в кадре, например из колонок или инструмента."},
    {"prompt": "Для чего используют Woosh эффекты?", "response": "Woosh эффекты создают звуки пролёта или перехода между сценами для динамики."},
    {"prompt": "Что такое импакты в саунд-дизайне?", "response": "Импакты — мощные звуковые удары, подчёркивающие важные монтажные точки."},
    {"prompt": "Что делает цветовая градация?", "response": "Цветовая градация создаёт художественный образ с помощью цветовых схем и LUT."},
    {"prompt": "Чем цветокоррекция отличается от градации?", "response": "Цветокоррекция исправляет технические дефекты, градация создаёт стиль и настроение."},
    {"prompt": "Что такое PowerGrades в DaVinci Resolve?", "response": "PowerGrades — готовые пресеты цветокоррекции, сохраняемые для повторного использования."},
    {"prompt": "Для чего используют цветовые кривые?", "response": "Цветовые кривые позволяют точно настроить баланс теней, средних тонов и светов."},
    {"prompt": "Что такое виньетирование в цветокоррекции?", "response": "Виньетирование затемняет края кадра для фокусировки внимания на центре."},
    {"prompt": "Что означает композитинг?", "response": "Композитинг создаёт визуальные эффекты путём наложения нескольких слоёв изображения."},
    {"prompt": "Для чего нужна стабилизация Warp Stabilizer?", "response": "Warp Stabilizer анализирует движение камеры и сглаживает дрожание в Premiere Pro."},
    {"prompt": "Что делает Magic Mask 2 в DaVinci Resolve?", "response": "Magic Mask 2 использует ИИ для автоматического отслеживания объектов без ротоскопинга."},
    {"prompt": "Для чего служит Fusion Page?", "response": "Fusion Page предназначена для профессионального композитинга и 3D-графики в Resolve."},
    {"prompt": "Что такое бордоматик?", "response": "Бордоматик — анимированный баннер для показа на борту самолёта или автобуса."},
    {"prompt": "Что подразумевает дэдлайн в производстве?", "response": "Дэдлайн — крайний срок сдачи готового видеоматериала заказчику."},
    {"prompt": "Что такое пэкшот?", "response": "Пэкшот — крупный план упаковки товара в рекламном ролике."},
    {"prompt": "Для чего используют кастинг?", "response": "Кастинг — отбор актёров или ведущих для видеопроекта."},
    {"prompt": "Что такое шапка видео?", "response": "Шапка — начальный блок проекта со заставкой и титрами."},
    {"prompt": "Что означает прямой видеомонтаж?", "response": "Прямой монтаж выполняется с оригинальных файлов без промежуточных копий."},
    {"prompt": "Для чего применяют затухание?", "response": "Затухание плавно уменьшает яркость или громкость в конце сцены."},
    {"prompt": "Что такое вытеснение в переходах?", "response": "Вытеснение — переход, где один кадр выталкивает другой с экрана."},
    {"prompt": "Что подразумевает монтаж по времени?", "response": "Монтаж по времени синхронизирует длительность кадров с музыкой или ритмом."},
    {"prompt": "Для чего используют скрытый монтаж?", "response": "Скрытый монтаж маскирует переходы движением камеры или объектов."},
    {"prompt": "Что такое наложение кадров?", "response": "Наложение кадров создаёт эффект прозрачности и многократного изображения."},
    {"prompt": "Для чего нужна Voice Isolation?", "response": "Voice Isolation отделяет речь от фонового шума с помощью ИИ."},
    {"prompt": "Что такое Auto Reframe?", "response": "Auto Reframe автоматически адаптирует горизонтальное видео под вертикальный формат."},
    {"prompt": "Для чего используют MultiText?", "response": "MultiText позволяет редактировать текст посимвольно с анимацией."},
    {"prompt": "Что такое Spatial Audio?", "response": "Spatial Audio создаёт объёмное звучание с позиционированием источников."},
    {"prompt": "Для чего применяют Time Stretching?", "response": "Time Stretching изменяет длительность аудио без изменения высоты тона."},
    {"prompt": "Что такое Match Move?", "response": "Match Move отслеживает движение объекта для наложения эффектов."},
    {"prompt": "Что делает Content-Aware Fill?", "response": "Content-Aware Fill умно заполняет удалённые области похожим контентом."},
    {"prompt": "Для чего используют Roto Brush?", "response": "Roto Brush пиксельно выделяет движущиеся объекты для маскировки."},
    {"prompt": "Что такое Morph Cut?", "response": "Morph Cut сглаживает переходы между похожими дублями говорящего."},
    {"prompt": "Что такое битрейт видео?", "response": "Битрейт видео — это объём данных, передаваемых в секунду; чем выше битрейт, тем лучше качество, но больше размер файла."},
    {"prompt": "Для чего нужен proxy-режим в монтаже?", "response": "Proxy-режим нужен для ускорения работы с тяжёлыми 4K/8K файлами за счёт временной замены их на лёгкие копии."},
    {"prompt": "Что такое транскодирование?", "response": "Транскодирование — это преобразование видео из одного кодека или формата в другой."},
    {"prompt": "Как работает ключевой кадр (keyframe)?", "response": "Ключевой кадр фиксирует значение параметра в определённый момент времени, а программа интерполирует изменения между ними."},
    {"prompt": "Что означает термин 'render' в видеомонтаже?", "response": "Render — это процесс окончательной обработки проекта в готовый видеофайл."},
    {"prompt": "Что такое таймкод?", "response": "Таймкод — это временная метка, обозначающая точное положение кадра в формате часы:минуты:секунды:кадры."},
    {"prompt": "Для чего нужен аудиометр в монтажной программе?", "response": "Аудиометр показывает уровень громкости звука, чтобы избежать перегрузки и обеспечить нормальную слышимость."},
    {"prompt": "Что такое B-roll?", "response": "B-roll — дополнительные кадры, используемые для иллюстрации, поддержки повествования или маскировки монтажа."},
    {"prompt": "Чем отличается A-roll от B-roll?", "response": "A-roll — основной материал (например, интервью), B-roll — сопроводительные кадры (действия, окружение)."},
    {"prompt": "Что такое клип в монтаже?", "response": "Клип — это отдельный видео- или аудиофрагмент, импортированный в проект."},
    {"prompt": "Для чего используется эффект блюра (blur)?", "response": "Эффект блюра размывает части кадра для фокусировки внимания, маскировки деталей или создания атмосферы."},
    {"prompt": "Что такое шумоподавление в аудио?", "response": "Шумоподавление — это процесс удаления фоновых шумов (гул, шипение) из звуковой дорожки."},
    {"prompt": "Что означает 'резать по звуку'?", "response": "Резать по звуку — значит синхронизировать монтажные точки с аудиособытиями, например, с ударом или словом."},
    {"prompt": "Что такое зум-пан (Ken Burns effect)?", "response": "Зум-пан — эффект плавного масштабирования и перемещения по статичному изображению для создания движения."},
    {"prompt": "Для чего нужен цветовой круг в грейдинге?", "response": "Цветовой круг помогает точно корректировать оттенки и настраивать цветовой баланс в сцене."},
    {"prompt": "Что такое HDR в видео?", "response": "HDR (High Dynamic Range) — технология, расширяющая диапазон яркости и цвета для более реалистичного изображения."},
    {"prompt": "Что означает 'сжатие по времени'?", "response": "Сжатие по времени — ускорение видеоряда для укладки в заданную длительность без потери смысла."},
    {"prompt": "Для чего нужна сетка правил третей?", "response": "Сетка правил третей помогает компоновать кадр гармонично, размещая ключевые элементы на пересечениях линий."},
    {"prompt": "Что такое саундтрек в контексте монтажа?", "response": "Саундтрек — фоновая музыка, сопровождающая видео и усиливающая эмоциональное восприятие."},
    {"prompt": "Что означает 'чистый кадр'?", "response": "Чистый кадр — участок видео без текста, логотипов или других графических элементов для последующего использования."},
    {"prompt": "Для чего нужен дублирующийся аудиоканал?", "response": "Дублирующийся аудиоканал используется для резервной записи или совмещения разных микрофонов."},
    {"prompt": "Что такое offcut?", "response": "Offcut — отсечённый, неиспользованный фрагмент оригинального материала, отброшенный при монтаже."},
    {"prompt": "Что такое динамический диапазон звука?", "response": "Динамический диапазон — разница между самым тихим и самым громким звуком в записи."},
    {"prompt": "Для чего нужен компрессор в аудиомонтаже?", "response": "Компрессор сглаживает перепады громкости, делая звук более ровным и контролируемым."},
    {"prompt": "Что такое гистограмма в цветокоррекции?", "response": "Гистограмма — график распределения яркости пикселей, помогающий корректировать экспозицию и контраст."},
    {"prompt": "Что такое векторный скоп?", "response": "Векторный скоп — инструмент анализа цвета, показывающий насыщенность и оттенки в виде круговой диаграммы."},
    {"prompt": "Что значит 'не выйти за Safe Margins'?", "response": "Не выйти за Safe Margins — значит размещать текст и важные элементы внутри безопасной зоны, видимой на всех экранах."},
    {"prompt": "Что такое параллакс в моушн-графике?", "response": "Параллакс — эффект разной скорости движения слоёв, создающий иллюзию глубины."},
    {"prompt": "Для чего нужен обратный монтаж?", "response": "Обратный монтаж используется для создания драматического эффекта или пересмотра событий в обратной хронологии."},
    {"prompt": "Что такое временная линия (timeline)?", "response": "Временная линия — основная рабочая зона, где располагаются и редактируются все элементы проекта по времени."},
    {"prompt": "Что означает 'отбить кадры'?", "response": "Отбить кадры — точно выбрать начало и конец каждого клипа для монтажа."},
    {"prompt": "Для чего нужен плейбек в монтаже?", "response": "Плейбек — воспроизведение проекта в реальном времени для оценки результата и поиска ошибок."},
    {"prompt": "Что такое слоевой монтаж?", "response": "Слоевой монтаж — наложение нескольких видеодорожек для создания сложных визуальных эффектов."},
    {"prompt": "Что такое звуковая дорожка?", "response": "Звуковая дорожка — отдельная линия в таймлайне, содержащая аудиозапись (речь, музыку, эффекты)."},
    {"prompt": "Для чего нужен эффект 'заморозка кадра'?", "response": "Эффект 'заморозка кадра' фиксирует изображение на несколько секунд для акцента или стилизации."},
    {"prompt": "Что такое цветовая температура?", "response": "Цветовая температура измеряется в Кельвинах и определяет, насколько изображение тёплое (оранжевое) или холодное (синее)."},
    {"prompt": "Что такое кадровая частота (frame rate)?", "response": "Кадровая частота — количество кадров, отображаемых в секунду; стандартные значения: 24, 25, 30, 60 fps."},
    {"prompt": "Для чего нужен эффект 'дрожание камеры'?", "response": "Эффект 'дрожание камеры' имитирует ручную съёмку, добавляя реализм или напряжение сцене."},
    {"prompt": "Что такое монохромный монтаж?", "response": "Монохромный монтаж — использование чёрно-белой палитры для создания стиля или акцента на форме и свете."},
    {"prompt": "Что означает 'запас по движению'?", "response": "Запас по движению — дополнительные секунды до и после действия, необходимые для плавного монтажа и эффектов."},
    {"prompt": "Для чего нужен скрининг?", "response": "Скрининг — показ готового проекта для команды или заказчика с последующим обсуждением правок."},
    {"prompt": "Что такое реверсивный клип?", "response": "Реверсивный клип — видео, воспроизводимое в обратном направлении для создания необычного эффекта."},
    {"prompt": "Что такое аудиосинхронизация?", "response": "Аудиосинхронизация — выравнивание звука и видео по временной шкале для точного совпадения."},
    {"prompt": "Для чего нужен эффект 'глитч'?", "response": "Эффект 'глитч' имитирует цифровые сбои и используется для стилизации или передачи хаоса."},
    {"prompt": "Что такое пиксельное разрешение?", "response": "Пиксельное разрешение — количество пикселей по горизонтали и вертикали (например, 1920×1080)."},
    {"prompt": "Что означает 'сжать проект'?", "response": "Сжать проект — удалить неиспользуемые файлы и уменьшить его размер для архивации или передачи."},
    {"prompt": "Для чего нужен эффект 'размытие в движении'?", "response": "Эффект 'размытие в движении' имитирует естественное размытие быстрых объектов, делая анимацию реалистичной."},
    {"prompt": "Что такое звуковой лог?", "response": "Звуковой лог — таблица с описанием аудиофрагментов, используемая для быстрого поиска нужных записей."},
    {"prompt": "Что означает 'отдать проект клиенту'?", "response": "Отдать проект клиенту — предоставить готовый видеофайл в согласованном формате и качестве."},
    {"prompt": "Для чего нужен эффект 'тепло/холод' в грейдинге?", "response": "Эффект 'тепло/холод' задаёт эмоциональный тон: тепло — уют, воспоминания; холод — отчуждение, напряжение."},
    {"prompt": "Что подразумевается под видеомонтажом?", "response": "Видеомонтаж — процесс объединения и упорядочивания видеокадров в единый материал."},
    {"prompt": "Какую функцию выполняет видеомонтаж?", "response": "Он обеспечивает логичную структуру и целостность видеоряда."},
    {"prompt": "Зачем нужен монтаж видеоматериала?", "response": "Для удаления лишних фрагментов и акцентирования важного."},
    {"prompt": "Что является целью видеомонтажа?", "response": "Передача смысла и информации в удобной для восприятия форме."},
    {"prompt": "Почему видеомонтаж важен при создании видео?", "response": "Он превращает отдельные кадры в законченный продукт."},
    {"prompt": "Как монтаж влияет на восприятие видео?", "response": "Он определяет темп и понятность повествования."},
    {"prompt": "Что формирует монтаж в видеоролике?", "response": "Структуру, ритм и последовательность событий."},
    {"prompt": "Почему необработанное видео выглядит несвязным?", "response": "Отсутствует монтажная логика и структура."},
    {"prompt": "Как монтаж помогает донести идею?", "response": "Через порядок кадров и визуальные акценты."},
    {"prompt": "Что делает видеомонтаж эффективным?", "response": "Чёткая структура и соответствие замыслу автора."},
    {"prompt": "Чем профессиональный монтаж отличается от любительского?", "response": "Профессиональный монтаж логичен и визуально аккуратен."},
    {"prompt": "Как выглядит качественный видеомонтаж?", "response": "Видео воспринимается целостно и без резких ошибок."},
    {"prompt": "Почему хороший монтаж малозаметен?", "response": "Он не отвлекает зрителя от содержания."},
    {"prompt": "Что указывает на низкое качество монтажа?", "response": "Нарушенный ритм и случайные переходы."},
    {"prompt": "Почему важен ритм в видеомонтаже?", "response": "Он влияет на динамику и восприятие информации."},
    {"prompt": "Какие программы применяют для видеомонтажа?", "response": "Используются специализированные видеоредакторы."},
    {"prompt": "Зачем нужны профессиональные монтажные программы?", "response": "Для точного контроля изображения и звука."},
    {"prompt": "Почему выбор программы для монтажа важен?", "response": "Он влияет на качество и удобство работы."},
    {"prompt": "Чем сложные видеоредакторы отличаются от простых?", "response": "Они поддерживают многослойный монтаж и эффекты."},
    {"prompt": "Можно ли делать монтаж в бесплатных программах?", "response": "Да, при базовых требованиях к проекту."},
    {"prompt": "Какие инструменты важны в видеоредакторе?", "response": "Таймлайн, работа со звуком и цветом."},
    {"prompt": "Зачем монтажеру знать возможности программы?", "response": "Для эффективной и быстрой работы."},
    {"prompt": "Как монтаж связан со звуком?", "response": "Звук синхронизируется с видеорядом."},
    {"prompt": "Почему звук важен при монтаже?", "response": "Он усиливает восприятие видео."},
    {"prompt": "Как монтаж влияет на атмосферу ролика?", "response": "Через темп и сочетание аудио и видео."},
    {"prompt": "Что такое монтажная склейка?", "response": "Соединение двух кадров без перехода."},
    {"prompt": "Для чего используют переходы?", "response": "Для плавного соединения сцен."},
    {"prompt": "Что такое таймлайн в видеомонтаже?", "response": "Рабочая область для размещения клипов во времени."},
    {"prompt": "Почему порядок кадров важен?", "response": "Он определяет смысл и логику видео."},
    {"prompt": "Как монтаж влияет на длительность видео?", "response": "Он позволяет сократить или расширить материал."},
    {"prompt": "Что такое монтажное решение?", "response": "Выбор способа соединения и показа кадров."},
    {"prompt": "Почему монтаж считается творческим процессом?", "response": "Он требует интерпретации исходного материала."},
    {"prompt": "Как монтаж помогает скрыть ошибки съёмки?", "response": "Путём замены и перестановки кадров."},
    {"prompt": "Почему монтаж важен в учебных видео?", "response": "Он повышает ясность и усвоение материала."},
    {"prompt": "Как видеомонтаж влияет на внимание зрителя?", "response": "Он регулирует темп подачи информации."},
    {"prompt": "Что такое финальный рендер видео?", "response": "Экспорт готового проекта в видеофайл."},
    {"prompt": "Почему монтаж завершается экспортом?", "response": "Для получения итогового видео."},
    {"prompt": "Как монтаж объединяет видео и звук?", "response": "Создавая единый синхронизированный материал."},
    {"prompt": "Почему видеомонтаж важен в медиа?", "response": "Он обеспечивает качество и понятность контента."},
    {"prompt": "Что является результатом видеомонтажа?", "response": "Готовый структурированный видеоролик."}
]


with open("data.jsonl", "w", encoding="utf-8") as f:
    for item in data:
        f.write(json.dumps(item, ensure_ascii=False) + "\n")

print(f"data.jsonl создан ({len(data)} примеров)")


# test_base_model.py

from transformers import AutoTokenizer, AutoModelForCausalLM
import torch

model_name = "Qwen/Qwen2.5-0.5B-Instruct"

tokenizer = AutoTokenizer.from_pretrained(model_name, trust_remote_code=True)
if tokenizer.pad_token is None:
    tokenizer.pad_token = tokenizer.eos_token

base_model = AutoModelForCausalLM.from_pretrained(
    model_name,
    dtype=torch.float16,
    device_map="auto",
    trust_remote_code=True,
)

test_prompts = [
    "Видеомонтаж — это",
    "Основная задача видеомонтажа заключается в том, что",
    "Хороший видеомонтаж отличается от любительского тем, что",
    "Для видеомонтажа чаще всего используют программы",
]

def generate_plain(model, tokenizer, prompt):
    text = f"Вопрос: {prompt}\nОтвет:"
    inputs = tokenizer(text, return_tensors="pt").to(model.device)

    outputs = model.generate(
        **inputs,
        max_new_tokens=50,
        temperature=0.2,
        top_p=0.9,
        do_sample=True,
        repetition_penalty=1.05,
        eos_token_id=tokenizer.eos_token_id,
    )

    decoded = tokenizer.decode(outputs[0], skip_special_tokens=True)
    return decoded.split("Ответ:")[-1].strip()

print("=== БАЗОВАЯ МОДЕЛЬ (ДО ОБУЧЕНИЯ) ===")
base_answers = {}
for prompt in test_prompts:
    answer = generate_plain(base_model, tokenizer, prompt)
    base_answers[prompt] = answer
    print(f"\nPrompt: {prompt}\nОтвет: {answer}")


# learning.py
import json
import torch
from datasets import load_dataset
from transformers import (
    AutoModelForCausalLM,
    AutoTokenizer,
    BitsAndBytesConfig,
    TrainingArguments,
    Trainer,
)
from peft import LoraConfig, get_peft_model
from dataclasses import dataclass
from typing import Dict, List


@dataclass
class DataCollatorForCausalLM:
    tokenizer: AutoTokenizer
    pad_to_multiple_of: int = 8

    def __call__(self, features: List[Dict]) -> Dict[str, torch.Tensor]:
        input_ids = [f["input_ids"] for f in features]
        labels = [f["labels"] for f in features]

        batch = self.tokenizer.pad(
            {"input_ids": input_ids},
            padding=True,
            pad_to_multiple_of=self.pad_to_multiple_of,
            return_tensors="pt",
        )

        max_len = batch["input_ids"].shape[1]

        padded_labels = []
        for label in labels:
            padded = label + [-100] * (max_len - len(label))
            padded_labels.append(padded)

        batch["labels"] = torch.tensor(padded_labels, dtype=torch.long)
        return batch



MODEL_NAME = "Qwen/Qwen2.5-0.5B-Instruct"
DATA_PATH = "data.jsonl"
MAX_LEN = 512

tokenizer = AutoTokenizer.from_pretrained(MODEL_NAME, trust_remote_code=True)
if tokenizer.pad_token is None:
    tokenizer.pad_token = tokenizer.eos_token


bnb_config = BitsAndBytesConfig(
    load_in_4bit=True,
    bnb_4bit_compute_dtype=torch.bfloat16,
    bnb_4bit_quant_type="nf4",
    bnb_4bit_use_double_quant=True,
)

model = AutoModelForCausalLM.from_pretrained(
    MODEL_NAME,
    quantization_config=bnb_config,
    device_map="auto",
    trust_remote_code=True,
)


lora_config = LoraConfig(
    r=32,
    lora_alpha=64,
    target_modules=[
        "q_proj", "k_proj", "v_proj", "o_proj",
        "gate_proj", "up_proj", "down_proj",
    ],
    lora_dropout=0.05,
    bias="none",
    task_type="CAUSAL_LM",
)

model = get_peft_model(model, lora_config)
model.enable_input_require_grads()
model.print_trainable_parameters()
model.gradient_checkpointing_enable()
model.config.use_cache = False


raw_data = load_dataset("json", data_files=DATA_PATH, split="train")

def format_row(example):
    prompt = example["prompt"]
    answer = example["response"]


    full_text = (
        f"<|im_start|>user\n{prompt}<|im_end|>\n"
        f"<|im_start|>assistant\n{answer}<|im_end|>"
    )


    full_tokens = tokenizer(
        full_text,
        truncation=True,
        max_length=MAX_LEN,
        padding=False,
    )

    input_ids = full_tokens["input_ids"]


    prompt_tokens = tokenizer(
        f"<|im_start|>user\n{prompt}<|im_end|>\n<|im_start|>assistant\n",
        truncation=True,
        max_length=MAX_LEN,
        padding=False,
    )
    prompt_len = min(len(prompt_tokens["input_ids"]), len(input_ids))

    labels = input_ids.copy()
    labels[:prompt_len] = [-100] * prompt_len

    return {
        "input_ids": input_ids,
        "labels": labels,
    }

dataset = raw_data.map(format_row, remove_columns=raw_data.column_names)


training_args = TrainingArguments(
    output_dir="./my-lora-model-best",
    per_device_train_batch_size=4,
    gradient_accumulation_steps=4,
    num_train_epochs=10,
    learning_rate=2e-4,
    warmup_ratio=0.03,
    bf16=torch.cuda.is_bf16_supported(),
    fp16=not torch.cuda.is_bf16_supported(),
    optim="paged_adamw_8bit",
    lr_scheduler_type="cosine",
    max_grad_norm=1.0,
    logging_steps=10,
    save_steps=50,
    report_to="none",
)

data_collator = DataCollatorForCausalLM(
    tokenizer=tokenizer,
    pad_to_multiple_of=8,
)

trainer = Trainer(
    model=model,
    args=training_args,
    train_dataset=dataset,
    data_collator=data_collator,
)

trainer.train()

model.save_pretrained("./my-lora-model-best")
tokenizer.save_pretrained("./my-lora-model-best")

#table.py
%matplotlib inline
import matplotlib.pyplot as plt

# предполагается, что trainer уже отработал: trainer.train()

logs = trainer.state.log_history  # тут те же записи, что были бы в trainer_state.json

steps = []
loss = []
lr = []
epochs = []

for log in logs:
    if "loss" in log:
        steps.append(log["step"])
        loss.append(log["loss"])
        lr.append(log.get("learning_rate", 0.0))
        epochs.append(log.get("epoch", 0.0))

# если epoch нет, нормализуем по шагам
if not epochs or all(e == 0.0 for e in epochs):
    max_step = max(steps) if steps else 1
    epochs = [s / max_step for s in steps]

plt.style.use("default")
fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(8, 6))

# 1) Training Loss
ax1.plot(epochs, loss, linewidth=2)
ax1.set_title("Training Loss")
ax1.set_xlabel("Epoch")
ax1.set_ylabel("Loss")
ax1.grid(True, alpha=0.3)

# 2) Learning Rate
ax2.plot(epochs, lr, linewidth=2)
ax2.set_title("Learning Rate")
ax2.set_xlabel("Epoch")
ax2.set_ylabel("Learning rate")
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

#test_lora_model.py
from peft import PeftModel

lora_model = PeftModel.from_pretrained(
    base_model,
    "./my-lora-model-best",
)

print("\n=== ОБУЧЕННАЯ МОДЕЛЬ (ПОСЛЕ LoRA) ===")
lora_answers = {}
for prompt in test_prompts:
    answer = generate_plain(lora_model, tokenizer, prompt)
    lora_answers[prompt] = answer
    print(f"\nPrompt: {prompt}\nОтвет: {answer}")


# versus.py
print("\n=== СРАВНЕНИЕ (BASE vs LORA) ===")
for prompt in test_prompts:
    print("\n" + "=" * 60)
    print(f"PROMPT: {prompt}")
    print("\nБАЗОВАЯ МОДЕЛЬ:")
    print(base_answers[prompt])
    print("\nLORA-МОДЕЛЬ:")
    print(lora_answers[prompt])
