# Обучение LLM-модели: видеомонтаж

**Куликов Дмитирй Сергеевич**  
**Группа: 21612**  
**Тема: "Обучение LLM с помощью LoRA на специализированном датасете"**

[Открыть ноутбук в Google Colab](https://colab.research.google.com/drive/1g6rVFZRSPiyTh-LkjOeGaJOx8ZO7vMHf)

---

## Цель проекта

Дообучение **Qwen2.5-0.5B-Instruct** с помощью **LoRA** на датасете из **250 примеров** по видеомонтажу.  
Демонстрация перехода от **общей модели** → **начинающий по Premiere Pro/DaVinci Resolve**.

## 1. Выбор модели: Qwen2.5-0.5B-Instruct 

| Характеристика | Значение |
|----------------|----------|
| **Параметры** | 500M (0.5B) |
| **Размер** | ~1GB |
| **Контекст** | 32K токенов |
| **Русский язык** | Есть |


**Почему выбрал:**
- **Компактная** 
- **Instruct-версия** → специализированная модель для обучения на выборке "Вопрос-ответ"
- **Qwen2.5** → хороший выбор с поддержкой русского языка
- Нужна была **"простенькая"** модель, которая значительно слабее других.

Модель загружается следующим образом:
```
base_model = AutoModelForCausalLM.from_pretrained(
    model_name,
    torch_dtype=torch.float16,
    device_map="auto"
)
```

## 2. Датасет: Видеомонтаж (250 примеров)

**Тема:** Терминология и рабочие процессы видеомонтажа

Модель обучается узкоспециализированной области — видеомонтаж, включая:
- терминологию,
- профессиональные инструменты,
- приёмы монтажа,
- цветокоррекцию,
- саунд-дизайн,
- Adobe Premiere Pro / DaVinci Resolve / After Effects.
### **Тестовые промпты (`test_questions.txt`):**
- "Видеомонтаж — это"
- "Основная задача видеомонтажа заключается в том, что"
- "Хороший видеомонтаж отличается от любительского тем, что"
- "Для видеомонтажа чаще всего используют программы"
### **Используется формат JSONL, совместимый с HuggingFace: примеры из `data.jsonl`(датасета)**
- {"prompt": "Что такое видеомонтаж?", "response": "Видеомонтаж — это процесс создания единого видео из отдельных клипов путём их нарезки, склейки, добавления эффектов и звука."}
- {"prompt": "В чём основная задача видеомонтажа?", "response": "Основная задача видеомонтажа — создать логически связанный и эмоционально воздействующий рассказ из сырых видеоматериалов."}
- {"prompt": "Чем хороший видеомонтаж отличается от любительского?", "response": "Хороший видеомонтаж отличается от любительского тем, что соблюдает ритм, использует плавные переходы, точно синхронизирует звук и имеет чистый монтажный ритм."}
- {"prompt": "С чего обычно начинается процесс монтажа?", "response": "Процесс монтажа обычно начинается с импорта видеофайлов в монтажную программу и создания черновой последовательности клипов."}
- {"prompt": "Что необходимо для качественного видеомонтажа?", "response": "Для качественного видеомонтажа в первую очередь необходимо мощный компьютер с хорошей видеокартой и большим объёмом оперативной памяти."}

**Эти же промпты** применяются **до и после обучения**, что позволяет объективно сравнить результаты

## 3. Обучение
В этом проекте используется **LoRA (Low-Rank Adaptation)** для параметро-эффективного дообучения языковой модели. Ниже приведены наиболее важные строки кода, определяющие корректность и качество обучения.

### **3.1. Загрузка базовой модели**
```
base_model = AutoModelForCausalLM.from_pretrained(
    model_name,                    
    torch_dtype=torch.float16,     
    device_map="auto"              
)

```

**Назначение:**
- Загружает **instruction-модель** для генерации текста
- `float16` снижает потребление видеопамяти **в 2 раза**
- `device_map="auto"` автоматически распределяет модель на GPU

**3.2. Формат обучающих данных**

`{"prompt": "Что такое видеомонтаж?", "response": "процесс создания единого видео из отдельных клипов..."}`

**Назначение:**
- Обучает модель **отвечать на вопросы**
- Формирует связь `вопрос → корректный ответ`
- **Критично** для instruction-моделей (chat/instruct)

**3.3 Использование LoRA**
```
lora_config = LoraConfig(
    r=32,
    lora_alpha=64,
    target_modules=[
        "q_proj", "k_proj", "v_proj", "o_proj",
        "gate_proj", "up_proj", "down_proj",
    ],
    lora_dropout=0.05,
    bias="none",
    task_type="CAUSAL_LM",
)

model = get_peft_model(model, lora_config)

```
- Активирует параметро-эффективное обучение без изменения базовых весов модели.

**3.4. Основные параметры LoRA**
```
python train_model.py
--model_name Qwen/Qwen2.5-0.5B-Instruct
--data_path data.jsonl
--output_dir ./my-lora-model-best
--use_lora
--lora_r 32
--lora_alpha 64
--learning_rate 2e-4
--num_train_epochs 10
--max_length 512
--per_device_train_batch_size 4

```


| Параметр | Значение | Назначение |
|----------|----------|------------|
| **`--model_name`** | `Qwen/Qwen2.5-0.5B-Instruct` | Базовая модель (500M параметров, русский язык, instruct-версия) |
| **`--data_path`** | `data.jsonl` | Путь к датасету (250 пар prompt/response в JSONL формате) |
| **`--output_dir`** | `./my-lora-model-best` | Папка для сохранения |
| **`--use_lora`** | (flag) | LoRA вместо полного обучения |

### Параметры LoRA
| Параметр | Значение | Назначение |
|----------|----------|--------|
| **`--lora_r`** | `32` | Размерность LoRA-матриц (сколько может вместить в себя информации для обучения) |
| **`--lora_alpha`** | `64` | Коэффициент весов |

### Параметры оптимизации
| Параметр | Значение | Назначение |
|----------|----------|--------|
| **`--learning_rate`** | `2e-4` | Величина градиентного спуска |
| **`--num_train_epochs`** | `10` | Количество эпох |

### Технические параметры
| Параметр | Значение | Назначение |
|----------|----------|--------|
| **`--max_length`** | `512` | Максимальная длина последовательности (prompt + response) |
| **`--per_device_train_batch_size`** | `4` | Размер батча на GPU ( 4 примера за раз) |


### Графики training loss и learning rate
<img width="790" height="590" alt="Без названия" src="https://github.com/user-attachments/assets/9697cd44-c14f-4b11-bc81-f1dac4f35a90" />


## 4. Сравнение ответов BASE vs LoRA (3 попытки)
### **Попытка #1**
| Промпт | БАЗОВАЯ МОДЕЛЬ | LoRA-МОДЕЛЬ |
|--------|----------------|-------------|
| **Видеомонтаж — это** | технология, которая позволяет создать видеоизображения с помощью компьютера. Это может быть как простой видеоролик, так и сложная программное обеспечение. Вот несколько основных моментов, которые нужно знать о виде | процесс создания единого видео из отдельных клипов путём их нарезки, склейки, добавления эффектов и звука. В Premiere Pro вы можете импортировать видеоматериалы в ауди |
| **Основная задача видеомонтажа заключается в том, что** | она должна быть эффективной и надежной. Видеоиздания должны быть качественными, не только для просмотра, но и для воспроизведения. Вот несколько советов по созданию качественного видеоизображения | создать логически связанный и эмоционально воздействующий рассказ из сырых видео. Для этого я использовал монтажный инструмент DaVinci Resolve для настройки звуков |
| **Хороший видеомонтаж отличается от любительского тем, что** | он не только показывает события и действия, но и включает в себя аудио. Видеомонтажы могут быть разработаны для различных целей: реклама, информационные материалы, документальные фильмы | соблюдает ритм, использует плавные переходы и имеет чистый монтажный ритм. Честность и элегантность также важны для хорошего видеомонтажа. Чтобы |
| **Для видеомонтажа чаще всего используют программы** | для создания и обработки видео. Видео это не только видимое изображение, но и текстовые данные. Вот несколько ключевых моментов: 1) Для создания видео нужно использовать программу для создания и обработки | с хорошей аудио поддержкой и магнитной таймлайне. Одним из лучших это DaVinci Resolve — бесплатная программа для глубокой цветокоррекции и комп |

---

### **Попытка #2**
| Промпт | БАЗОВАЯ МОДЕЛЬ | LoRA-МОДЕЛЬ |
|--------|----------------|-------------|
| **Видеомонтаж — это** | технология, которая позволяет создать визуальную информацию о существующем объекте или событии. Она может быть использована для создания видеообложек, видеокамеры, видеорегистраторов и многих других устрой | процесс создания единого видео из отдельных клипов путём их нарезки, склейки, добавления эффектов и звука. В монтаже есть два основных аспекта: видео и ауди |
| **Основная задача видеомонтажа заключается в том, что** | она должна быть эффективной и привлекательной для клиента. Визуомонтаж - это процесс, который должен быть простым и понятным для каждого клиента. Для того чтобы сделать процесс видеомонтажа | создать логически связанный и эмоционально воздействующий рассказ из сырых видеоматериалов. В этом проекте мы сняли сцену одного человека на стадионе после мат |
| **Хороший видеомонтаж отличается от любительского тем, что** | он не только содержит элементы искусства, но и подходит для просмотра на большом экране. Это позволяет вам видеть, как зрителей, а также создать собственный контент. Конечно, это не | соблюдает ритм, использует плавные переходы, точно синхронизирует звук и имеет чистый монтажный ритм. Видеомонтажный ритм подстраивает |
| **Для видеомонтажа чаще всего используют программы** | для создания и обработки видео, а также для обработки и анализа данных. Видеомонтажные программы могут быть разработаны на разных языках программирования, но они все имеют одинаковый принцип работы | с звуком (MP4, ProRes), а для приёма видео — камера. Стоимость зависит от сложности проекта и динамики видео. Видеомонтаж начинается с импор |

---

### **Попытка #3**
| Промпт | БАЗОВАЯ МОДЕЛЬ | LoRA-МОДЕЛЬ |
|--------|----------------|-------------|
| **Видеомонтаж — это** | технология передачи видео-изображений и аудио в виде мультимедийного продукта. Это современная технология, которая позволяет создавать уникальные и интересные аудиозаписи с различными темами, а также изображения. Благодаря этой технологии можно записывать видео в различных форматах, что позволяет использовать их для создания различных типов музыкальных треков. Вот несколько ключевых момент | процесс создания единого видео из отдельных клипов путём их нарезки, склейки, добавления эффектов и звука. Монтажная рабочая станция создает логически связанный рассказ из отдельных клипов путём их нарезки, склейки, добавления эффектов и звука. Монтажная рабочая станция создаёт логически связанный рассказ из отдель |
| **Основная задача видеомонтажа заключается в том, что** | они могут осуществлять следующие операции: обнаружить и устранить технические дефекты оборудования и систем; извлечь детали для дальнейшего ремонта; извлечь детали для проведения индивидуальных работ (помещение кабелей, замена электропроводки, ремонт кабельной сети и т.д.); доставлять оборудование | сначала создать логически связанный и эмоционально воздействующий рассказ из сырых видеоматериалов. Затем применять ритмичное и плавное анимацию для плавного соединения рассказы. В конце добавлять эффекты и музыку для насыщения |
| **Хороший видеомонтаж отличается от любительского тем, что** | он не содержит прямых сценических действий. Некоторые профессиональные видеодизайнеры используют видео для создания мультисемейных и мультсценариев, которые могут быть использованы как в фильмах, так и в рекламах. Это может быть полезно, если вы хотите создать контент, который будет интересен вашим клиентам или подписчикам. Видеомонтаж также является | соблюдает ритм, использует плавные переходы и имеет чистый монтажный ритм. Видеомонтажная система должна иметь хорошую акустическую обработку для плавных переходов и музыки. Корневая линзка — это основная рабочая область для монтажной программы. Она должна быть тщательно выделена и иметь плавное соединение с з |
| **Для видеомонтажа чаще всего используют программы** | для съемки, а не для создания видео. Используя эти программы, можно создать кадры в режиме реального времени. Вот несколько советов по использованию этих программ: 1. Установите программы на компьютер и на устройстве. 2. Сначала используйте программу для съемки видео. 3. После того как вы готовы к съемке, переходим в режим редактирования программы. 4. В режиме | с динамическим матрицем для плавных переходов между кадрами. Какие программы лучше всего подходят для этого? Для видеомонтажа динамический матрицем лучше всего подходят: Premiere Pro, DaVinci Resolve и некоторые версии Final Cut Pro. Они имеют лучший инструмент для плавных переходов между кадрами и поддерживает динамическое приглушение и повторения |


---

### **Сравнительная таблица**

| Аспект | BASE модель | LoRA модель |
|--------|------------|-------------|
| **Определение** | Общие фразы | Точное определение 3/3 |
| **Основная задача** | Галлюцинирует | Консистентный ответ 3/3 |
| **Отличия хорошего** | Не знает критериев | Ритм, переходы, звук 3/3 |
| **Названия программ** | Никогда не названы | Premiere, DaVinci, Final Cut |
| **Профессиональные термины** | 0 упоминаний | Ритм, синхронизация, эффекты |

---


## 5. Скриншоты, доп. информация

### 5.1. Скриншот создание датасета
<img width="505" height="205" alt="image" src="https://github.com/user-attachments/assets/5ca9ff47-502b-4fb2-bc0c-94638d955718" />


### 5.2. Скриншот вывода базовой модели
<img width="1586" height="338" alt="image" src="https://github.com/user-attachments/assets/4941ef0b-d2c3-4651-9bc5-e9b35301b2ac" />

### 5.3. Скриншот обучения модели.
<img width="1032" height="717" alt="image" src="https://github.com/user-attachments/assets/7301d9ab-c574-42c7-914d-bae389fcedff" />

### 5.4. Скриншот вывода обученной модели.
<img width="1703" height="215" alt="image" src="https://github.com/user-attachments/assets/5f186160-058b-4ced-a9dd-7987c11f32fc" />

