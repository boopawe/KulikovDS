# Обучение LLM-модели: видеомонтаж

**Куликов Дмитирй Сергеевич**  
**Группа: 21612**  
**Тема: "Обучение LLM с помощью LoRA на специализированном датасете"**

Ссылка на colab: https://colab.research.google.com/drive/1g6rVFZRSPiyTh-LkjOeGaJOx8ZO7vMHf?usp=sharing

---

## Цель проекта

Дообучение **Qwen2.5-0.5B-Instruct** с помощью **LoRA** на датасете из **150 примеров** по видеомонтажу.  
Демонстрация перехода от **общей модели** → **начинающий по Premiere Pro/DaVinci Resolve**.

## 1. Выбор модели: Qwen2.5-0.5B-Instruct 

| Характеристика | Значение |
|----------------|----------|
| **Параметры** | 500M (0.5B) |
| **Размер** | ~1GB |
| **Контекст** | 32K токенов |
| **Русский язык** | Есть |


**Почему выбрал:**
- **Компактная** 
- **Instruct-версия** → специализированная модель для обучения на выборке "Вопрос-ответ"
- **Qwen2.5** → хороший выбор с поддержкой русского языка
- Нужна была **"простенькая"** модель, которая значительно слабее других.

Модель загружается следующим образом:
```
base_model = AutoModelForCausalLM.from_pretrained(
    model_name,
    torch_dtype=torch.float16,
    device_map="auto"
)
```

## 2. Датасет: Видеомонтаж (150 примеров)

**Тема:** Терминология и рабочие процессы видеомонтажа

Модель обучается узкоспециализированной области — видеомонтаж, включая:
- терминологию,
- профессиональные инструменты,
- приёмы монтажа,
- цветокоррекцию,
- саунд-дизайн,
- Adobe Premiere Pro / DaVinci Resolve / After Effects.
### **Тестовые промпты (`test_questions.txt`):**
- "Видеомонтаж — это"
- "Основная задача видеомонтажа заключается в том, что"
- "Хороший видеомонтаж отличается от любительского тем, что"
- "Для видеомонтажа чаще всего используют программы"
### **Используется формат JSONL, совместимый с HuggingFace: примеры из `data.jsonl`(датасета)**
- {"prompt": "Что такое видеомонтаж?", "response": "Видеомонтаж — это процесс создания единого видео из отдельных клипов путём их нарезки, склейки, добавления эффектов и звука."}
- {"prompt": "В чём основная задача видеомонтажа?", "response": "Основная задача видеомонтажа — создать логически связанный и эмоционально воздействующий рассказ из сырых видеоматериалов."}
- {"prompt": "Чем хороший видеомонтаж отличается от любительского?", "response": "Хороший видеомонтаж отличается от любительского тем, что соблюдает ритм, использует плавные переходы, точно синхронизирует звук и имеет чистый монтажный ритм."}
- {"prompt": "С чего обычно начинается процесс монтажа?", "response": "Процесс монтажа обычно начинается с импорта видеофайлов в монтажную программу и создания черновой последовательности клипов."}
- {"prompt": "Что необходимо для качественного видеомонтажа?", "response": "Для качественного видеомонтажа в первую очередь необходимо мощный компьютер с хорошей видеокартой и большим объёмом оперативной памяти."}

**Эти же промпты** применяются **до и после обучения**, что позволяет объективно сравнить результа

## 3. Обучение
В этом проекте используется **LoRA (Low-Rank Adaptation)** для параметро-эффективного дообучения языковой модели. Ниже приведены наиболее важные строки кода, определяющие корректность и качество обучения.

### **3.1. Загрузка базовой модели**
```
base_model = AutoModelForCausalLM.from_pretrained(
    model_name,                    
    torch_dtype=torch.float16,     
    device_map="auto"              
)

```

**Назначение:**
- Загружает **instruction-модель** для генерации текста
- `float16` снижает потребление видеопамяти **в 2 раза**
- `device_map="auto"` автоматически распределяет модель на GPU

**3.2. Формат обучающих данных**
`{"prompt": "Что такое видеомонтаж?", "response": "процесс создания единого видео из отдельных клипов..."}`

**Назначение:**
- Обучает модель **отвечать на вопросы**
- Формирует связь `вопрос → корректный ответ`
- **Критично** для instruction-моделей (chat/instruct)

**3.3 Использование LoRA**
`--use_lora`
- Активирует параметро-эффективное обучение без изменения базовых весов модели.

**3.4. Основные параметры LoRA**
```
python train_model.py
--model_name Qwen/Qwen2.5-0.5B-Instruct
--data_path data.jsonl
--output_dir ./my-lora-model-best
--use_lora
--lora_r 32
--lora_alpha 64
--learning_rate 2e-4
--num_train_epochs 10
--max_length 512
--per_device_train_batch_size 4

```


| Параметр | Значение | Назначение |
|----------|----------|------------|
| **`--model_name`** | `Qwen/Qwen2.5-0.5B-Instruct` | Базовая модель (500M параметров, русский язык, instruct-версия) |
| **`--data_path`** | `data.jsonl` | Путь к датасету (150 пар prompt/response в JSONL формате) |
| **`--output_dir`** | `./my-lora-model-best` | Папка для сохранения |
| **`--use_lora`** | (flag) | LoRA вместо полного обучения |

### Параметры LoRA
| Параметр | Значение | Назначение |
|----------|----------|--------|
| **`--lora_r`** | `32` | Размерность LoRA-матриц (сколько может вместить в себя информации для обучения) |
| **`--lora_alpha`** | `64` | Коэффициент весов |

### Параметры оптимизации
| Параметр | Значение | Назначение |
|----------|----------|--------|
| **`--learning_rate`** | `2e-4` | Величина градиентного спуска |
| **`--num_train_epochs`** | `10` | Количество эпох |

### Технические параметры
| Параметр | Значение | Назначение |
|----------|----------|--------|
| **`--max_length`** | `512` | Максимальная длина последовательности (prompt + response) |
| **`--per_device_train_batch_size`** | `4` | Размер батча на GPU ( 4 примера за раз) |


## 4. Сравнение ответов BASE vs LoRA (3 попытки)

### **Попытка #1**
| Промпт | БАЗОВАЯ МОДЕЛЬ | LoRA-МОДЕЛЬ |
|--------|----------------|-------------|
| `Видеомонтаж — это` | технология, которая позволяет создать видеоизображения с помощью компьютера... | процесс создания единого видео из отдельных клипов путём их нарезки, склейки, добавления эффектов и звука. В Premiere Pro... |
| `Основная задача видеомонтажа заключается в том, что` | она должна быть эффективной и надежной... | создать логически связанный и эмоционально воздействующий рассказ из сырых видео. Для этого я использовал DaVinci Resolve... |
| `Хороший видеомонтаж отличается от любительского тем, что` | он не только показывает события и действия, но и включает аудио... | соблюдает ритм, использует плавные переходы и имеет чистый монтажный ритм... |
| `Для видеомонтажа чаще всего используют программы` | для создания и обработки видео... | с хорошей аудио поддержкой и магнитной таймлайне. DaVinci Resolve... |

### **Попытка #2**
| Промпт | БАЗОВАЯ МОДЕЛЬ | LoRA-МОДЕЛЬ |
|--------|----------------|-------------|
| `Видеомонтаж — это` | технология, которая позволяет создать визуальную информацию... | процесс создания единого видео из отдельных клипов путём их нарезки, склейки... |
| `Основная задача видеомонтажа заключается в том, что` | она должна быть эффективной и привлекательной для клиента... | создать логически связанный и эмоционально воздействующий рассказ из сырых видеоматериалов... |
| `Хороший видеомонтаж отличается от любительского тем, что` | он не только содержит элементы искусства... | соблюдает ритм, использует плавные переходы, точно синхронизирует звук... |
| `Для видеомонтажа чаще всего используют программы` | для создания и обработки видео, а также для обработки данных... | с звуком (MP4, ProRes), а для приёма видео — камера... |

### **Попытка #3**
| Промпт | БАЗОВАЯ МОДЕЛЬ | LoRA-МОДЕЛЬ |
|--------|----------------|-------------|
| `Видеомонтаж — это` | технология передачи видео-изображений и аудио... | процесс создания единого видео из отдельных клипов путём их нарезки, склейки... |
| `Основная задача видеомонтажа заключается в том, что` | они могут осуществлять операции: обнаружить и устранить... | сначала создать логически связанный и эмоционально воздействующий рассказ... |
| `Хороший видеомонтаж отличается от любительского тем, что` | он не содержит прямых сценических действий... | соблюдает ритм, использует плавные переходы и имеет чистый монтажный ритм... |
| `Для видеомонтажа чаще всего используют программы` | для съемки, а не для создания видео... | Premiere Pro, DaVinci Resolve и Final Cut Pro... |

---

### **Анализ ключевых различий**
| Аспект | БАЗОВАЯ МОДЕЛЬ | LoRA-МОДЕЛЬ |
|--------|-------------|-------------|
| **Определение видеомонтажа** | общие фразы о "технологии" | точное описание процесса (3/3 попытки) |
| **Задача монтажа** | абстрактные формулировки | "логически связанный рассказ" (3/3) |
| **Хороший монтаж** | общие характеристики | ритм, переходы, синхронизация (3/3) |
| **Программы** | неконкретно | конкретные названия (2/3 попытки) |
| **Термины** | отсутствуют | Premiere Pro, DaVinci Resolve (5 упоминаний) |
